# Adyen CSE for Android
This repository contains Adyen's Client-Side Encryption (CSE) library for Android. With CSE card data is encrypted on the client (in this case the Android device) before you submit it through your own server to the Adyen API. By using CSE you reduce your scope of [PCI compliance](https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard), because no raw card data travels through your server. This repository can be leveraged as a starting point to integrate Adyen's payment functionality fully in-app.

## Requirements
The AdyenCSE-Android library is written in Java and is compatible with apps supporting Android 4.4 and up. Looking for the iOS or web equivalent? We have the CSE library also available in Objective-C ([adyen-cse-ios](https://github.com/Adyen/AdyenCSE-iOS)) and JavaScript ([adyen-cse-web](https://github.com/Adyen/CSE-JS)).

All our CSE libraries rely on you [setting up your own server](https://docs.adyen.com/developers/adyen-mobile-checkout#merchantserver) for communicating with the Adyen API. By using a server you ensure that API authentication credentials never get exposed. Please note that you need to have [signed up for an account at Adyen](https://www.adyen.com/signup) before you can send requests to the Adyen API.

## Example

For your convenience this repository contains an example app that can be used as a reference while integrating.

To run the example project, clone the repo and run it from your IDE.

## Installation

AdyenCSE is available through a gradle task. To install it, simply execute the following steps:

1. In your `build.gradle` of the root directory add the following line:
    
    ```json
    buildscript {
        repositories {
            ...
        }
        dependencies {
            ...
            classpath 'de.undercouch:gradle-download-task:2.1.0'
        }
    }
    ```
    This plugin will allow Gradle to download the AdyenCSE library.
    
2. In your `build.gradle` of the app module add the following task:

    ```json
    import de.undercouch.gradle.tasks.download.Download
    
    ...
    
    task downloadAdyenLibrary(type: Download) {
        src 'https://raw.githubusercontent.com/Adyen/AdyenCSE-Android/master/adyencse/adyencse-1.0.0.aar'
        dest('libs');
    }
    ```
   Once you run this task using `./gradlew downloadAdyenLibrary` command, the `adyencse` .aar file will be downloaded in you `libs` folder.
   
3. Next add the following snippet in your `build.gradle` of the app module:

    ```json
    repositories {
        flatDir {
            dirs 'libs'
        }
    }
    ```

## Usage

```java
//	Set public key
String publicKey = @"10001|B243E873CB9220BAFE71...";

//	Create card object
Card card = new Card();
card.setCardHolderName("John A...");
card.setCvc("737");
card.setExpiryMonth("08");
card.setExpiryYear("2018");
card.setGenerationTime(new Date());
card.setNumber("55551...");
return card;

//	Encrypt card data
String encryptedCard = card.serialize(publicKey);
```

Note that you'll have to URL encode the `encryptedCard` value before sending it from the app to your server, as the `encryptedCard` which is generated by the CSE library and must be exactly the same as you send it from the server to the Adyen API.

## Next steps

### Server side

Once you get encrypted payment information on your server, you should submit it through an API call to the corresponding [Adyen endpoint](https://docs.adyen.com/developers/easy-encryption#apiendpointsee). For example, the code example below demonstrates how to pass payment data in JSON format:

```json
curl -u "ws@Company.YourCompany":"YourWsPassword" \
    -H "Content-Type: application/json" \
    -X POST \
    --data \
    '{
        "additionalData": {
        "card.encrypted.json":"adyenjs_0_1_4p1$..."
    },

    "amount" : {
        "value" : 2000,
        "currency" : "EUR"
    },

    "reference" : ["YourPaymentReference"],
    "merchantAccount" : ["YourMerchantAccountName"]
}'\
https://pal-test.adyen.com/pal/servlet/Payment/v18/authorise
```


### Recurring payments

If your business model requires to bill your customers on a recurring basis, you may enable recurring payments using the Adyen platform. In this case Adyen securely stores payment details when you make the first `authorisation` call, so that you no longer need to provide this data in the future.

To do this, add the `recurring` field to the payment request you make from your server to the Adyen platform. For example, if you want to enable both [shopper-not-present](https://docs.adyen.com/developers/recurring-manual#recurringpayment) and [one-click](https://docs.adyen.com/developers/recurring-manual#oneclickcardpayment) recurring modes for a specific payment, add the following field to the API call above:

```json
"recurring" : {
   "contract" : "RECURRING,ONECLICK"
}
```

For more information on recurring payments, refer to the [Adyen documentation](https://docs.adyen.com/developers/recurring-manual).

### Notifications

After you have developed your app, set up your merchant server and successfully performed your first [test payment](https://docs.adyen.com/developers/test-cards-manual) it's time to complete your integration by registering for Adyen's notification service. After each payment initiation we push a notification to your server with the authorisation response, so you can be sure whether you can start delivering your goods or services.

To subscribe to and integrate with the notification service, please check our [notification manual](https://docs.adyen.com/developers/easy-encryption#notificationsee).

### Going live

Successfully integrated with our notification service? Congratulations, now it's time to start accepting payments for real! Assuming that you've been using your Adyen test account and the Adyen API's test endpoints, you can now make use of your Adyen live account and Adyen API [live endpoints](https://docs.adyen.com/developers/easy-encryption#apiendpointsee).

## Questions?

If you have any questions or suggestions, please contact your account manager or send your inquiry to support@adyen.com.

## License

This repository is open-source and available under the [MIT license](https://en.wikipedia.org/wiki/MIT_License). See the LICENSE file for more information.
